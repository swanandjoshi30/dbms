-- Create the Emp table
CREATE TABLE Emp (
    Emp_no INT PRIMARY KEY,
    Emp_name VARCHAR(100),
    Emp_salary DECIMAL(10, 2)
);

-- Create the Tracking table
CREATE TABLE Tracking (
    Emp_no INT,
    Emp_salary DECIMAL(10, 2),
    action_type VARCHAR(10),
    action_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


DELIMITER //

CREATE TRIGGER trg_emp_salary_tracking
AFTER INSERT ON Emp
FOR EACH ROW
BEGIN
    -- Trigger for INSERT operation
    IF NEW.Emp_salary < 50000 THEN
        INSERT INTO Tracking (Emp_no, Emp_salary, action_type)
        VALUES (NEW.Emp_no, NEW.Emp_salary, 'INSERT');
    END IF;
END//

CREATE TRIGGER trg_emp_salary_update_tracking
AFTER UPDATE ON Emp
FOR EACH ROW
BEGIN
    -- Trigger for UPDATE operation
    IF NEW.Emp_salary < 50000 THEN
        INSERT INTO Tracking (Emp_no, Emp_salary, action_type)
        VALUES (NEW.Emp_no, NEW.Emp_salary, 'UPDATE');
    END IF;
END//

CREATE TRIGGER trg_emp_salary_delete_tracking
AFTER DELETE ON Emp
FOR EACH ROW
BEGIN
    -- Trigger for DELETE operation
    INSERT INTO Tracking (Emp_no, Emp_salary, action_type)
    VALUES (OLD.Emp_no, OLD.Emp_salary, 'DELETE');
END//

DELIMITER ;


-- Test INSERT with salary < 50000
INSERT INTO Emp (Emp_no, Emp_name, Emp_salary) VALUES (1, 'John Doe', 45000);

-- Test UPDATE with salary < 50000
UPDATE Emp SET Emp_salary = 45000 WHERE Emp_no = 1;

-- Test DELETE
DELETE FROM Emp WHERE Emp_no = 1;

-- Check the Tracking table for results
SELECT * FROM Tracking;



Alternate code of trigger

DELIMITER //

CREATE TRIGGER trg_emp_salary_tracking
AFTER INSERT OR UPDATE OR DELETE ON Emp
FOR EACH ROW
BEGIN
    -- For INSERT events: if the new salary is below 50,000
    IF (INSERTING AND NEW.Emp_salary < 50000) THEN
        INSERT INTO Tracking (Emp_no, Emp_salary, action_type)
        VALUES (NEW.Emp_no, NEW.Emp_salary, 'INSERT');
    
    -- For UPDATE events: if the updated salary is below 50,000
    ELSEIF (UPDATING AND NEW.Emp_salary < 50000) THEN
        INSERT INTO Tracking (Emp_no, Emp_salary, action_type)
        VALUES (NEW.Emp_no, NEW.Emp_salary, 'UPDATE');
    
    -- For DELETE events: log old salary without checking the value
    ELSEIF (DELETING) THEN
        INSERT INTO Tracking (Emp_no, Emp_salary, action_type)
        VALUES (OLD.Emp_no, OLD.Emp_salary, 'DELETE');
    END IF;
END//

DELIMITER ;
